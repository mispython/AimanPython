#!/usr/bin/env python3
"""
Program : PBBDPFMT
Function: product mapping and format definitions for banking deposit products
            and customer codes used across multiple SAS programs.

Amendment history:
- 11/05/04 RHA-A497 : Add product 182 (STAFF AL-WADIAH CA), 166 (CASH LINE FACILITY)
- 2006-2020         : Multiple SMR entries for branch mergers, new branches, and product updates
- Formats affected  : SADENOM, SAPROD (Savings)
                      FDDENOM, FDPROD (Fixed Deposits)
                      CADENOM, CAPROD (Current Accounts)

IMPORTANT: Any amendments to product mappings affect the formats listed above.
"""

from typing import Dict, List, Optional, Set, Tuple
from enum import Enum


# ============================================================================
# PRODUCT LISTS AND SETS
# ============================================================================

class ProductLists:
    """Container for product groupings used across deposit products."""

    # ACE (Account & Card Enhancement) Products
    ACE_PRODUCTS: Set[int] = {40, 42, 43, 150, 151, 152, 181}

    # FCY (Foreign Currency) Facility Products
    FCY_PRODUCTS: Set[int] = {350, 351, 352, 353, 354, 355, 356, 357, 358, 360, 361, 362}

    # Current Account Product Codes (CURX)
    CURX_PRODUCTS: Set[int] = {
        # Standard accounts
        3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
        20, 21, 22, 23, 24, 25, 26, 27, 35, 36, 37, 38, 39, 40, 41, 42, 43,
        45, 46, 47, 48, 49, 50, 51, 55, 56, 57, 58, 60, 61, 62, 63, 64,
        65, 66, 67, 68, 69, 70, 71, 73, 74, 75, 76, 77, 78, 81, 82, 83, 84, 85,
        86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 100, 101, 102, 106, 108,
        109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123,
        124, 125, 131, 132, 133, 134, 135, 137, 138, 150, 151, 152, 153, 154, 155,
        156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170,
        174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188,
        189, 190, 191, 192, 193, 194, 195, 196, 197, 198
    }


# ============================================================================
# FORMAT: SADENOM - Savings Account Denomination (Islamic or Domestic)
# ============================================================================

class SADenomFormat:
    """Savings Account Denomination Format.
    Maps savings product codes to Islamic (I) or Domestic (D) classification.
    """

    ISLAMIC_PRODUCTS: Set[int] = {204, 207, 214, 215, 218, 220, 221, 222, 223}

    @staticmethod
    def format(product_code: Optional[int]) -> str:
        """
        Apply SADENOM format to product code.

        Args:
            product_code: Product code to format

        Returns:
            'I' for Islamic products, 'D' for Domestic, empty string if None
        """
        if product_code is None:
            return ''

        return 'I' if product_code in SADenomFormat.ISLAMIC_PRODUCTS else 'D'


# ============================================================================
# FORMAT: SAPROD - Savings Account Product Code
# ============================================================================

class SAProductFormat:
    """Savings Account Product Format.
    Maps product codes to BNM account codes for General Ledger reporting.
    """

    MAPPINGS: Dict[int, str] = {
        100: 'N',  # GIRO
        126: 'N',  # PFB REMITTANCES BC NORM
        127: 'N',  # PFB - SHARE PUBLIC
        128: 'N',  # PFB - BC - SHARE BUMI
        129: 'N',  # PFB - DD
        140: 'N',  # SI-CLEARING ACCOUNT-PFB
        141: 'N',  # ATM-PISA CLEARING ACCT-PFB
        142: 'N',  # ATM-LOAN CLEARING ACCT-PFB
        200: '42120',  # NORMAL SAVINGS
        201: '42120',  # STAFF SAVINGS
        202: '42120',  # YOUNG ACHIEVER ACCOUNT
        203: '42120',  # 50 PLUS SAVINGS
        204: '42320',  # ISLAMIC BANKING AL-WADIAH
        205: '42120',  # BASIC SAVING A/C
        206: '42120',  # BASIC 55 SAVING A/C
        207: '42120',  # AL WADIAH SAVINGS
        208: '42120',  # PB BRIGHT STAR
        210: '42120',  # PB MYSALARY
        211: 'N',  # ATM-FD CLRG.
        212: '42120',  # WISE
        213: '42120',  # PB SAVELINK
        214: '42320',  # MUDHARABAH SAVINGS
        215: '42320',  # ALWADIAH SAVINGS (STAFF)
        216: '42120',  # PB UNIONPAY SAVINGS
        218: '42120',  # PB MYSALARY SAVINGS ACCOUNT-I
        220: '42120',  # (CM) SAVINGS ACC-I
        221: '42120',  # (CM) BASIC SA-I
        222: '42120',  # (CM) PB MYSALARY SA-I
        223: '42120',  # (CM) FORU2SAVE SA-I
        227: '42120',  # MONEYPLUS SA (STAFF)
        228: '42120',  # MONEYPLUS SA
        297: 'N',  # UMA1
        298: 'N',  # UMA3
        480: 'N',  # PB GOLD INVESTMENT
        481: 'N',  # PB GOLD INVESTMENT -STAFF
        482: 'N',  # CORP GOLD INVESTMENT ACCOUNT
        483: 'N',  # EGOLD INVESTMENT ACCOUNT (NON-STAFF)
        484: 'N',  # EGOLD INVESTMENT ACCOUNT (STAFF)
    }

    @staticmethod
    def format(product_code: Optional[int]) -> str:
        """
        Apply SAPROD format to product code.

        Args:
            product_code: Product code to format

        Returns:
            BNM account code or default '42120' for savings
        """
        if product_code is None:
            return '42120'

        return SAProductFormat.MAPPINGS.get(product_code, '42120')


# ============================================================================
# FORMAT: FDDENOM - Fixed Deposit Denomination (Islamic or Domestic)
# ============================================================================

class FDDenomFormat:
    """Fixed Deposit Denomination Format.
    Maps FD product codes to Islamic (I) or Domestic (D) classification.
    """

    ISLAMIC_RANGES: List[Tuple[int, int]] = [
        (229, 232), (272, 283), (334, 336), (338, 339), (340, 359),
        (379, 382), (386, 394), (453, 459), (461, 469), (542, 544),
        (580, 593), (595, 599), (603, 607), (609, 611), (620, 627),
        (640, 659), (660, 719), (726, 731), (736, 740), (780, 839),
        (851, 853), (856, 863), (893, 894), (896, 897), (902, 903),
        (914, 940), (941, 967), (987, 988), (991, 993)
    ]

    ISLAMIC_SINGLES: Set[int] = {
        422, 424, 426, 428, 475, 481, 487, 489, 491, 493, 495, 497, 499, 555, 557, 575, 777
    }

    @staticmethod
    def _is_in_range(code: int, ranges: List[Tuple[int, int]]) -> bool:
        """Check if code falls within any range."""
        return any(start <= code <= end for start, end in ranges)

    @staticmethod
    def format(product_code: Optional[int]) -> str:
        """
        Apply FDDENOM format to product code.

        Args:
            product_code: Product code to format

        Returns:
            'I' for Islamic products, 'D' for Domestic, empty string if None
        """
        if product_code is None:
            return ''

        is_islamic = (
                FDDenomFormat._is_in_range(product_code, FDDenomFormat.ISLAMIC_RANGES) or
                product_code in FDDenomFormat.ISLAMIC_SINGLES
        )

        return 'I' if is_islamic else 'D'


# ============================================================================
# FORMAT: FDPROD - Fixed Deposit Product Code
# ============================================================================

class FDProductFormat:
    """Fixed Deposit Product Format.
    Maps FD product codes to BNM account codes for General Ledger reporting.
    Comprehensive mapping with over 500 product codes.
    """

    MAPPINGS: Dict[int, str] = {
        229: '42133', 230: '42133', 231: '42133', 232: '42133',
        233: '42130', 234: '42130', 235: '42130', 236: '42130',
        237: '42130', 238: '42130', 239: '42130', 240: '42130',
        241: '42130', 242: '42130', 243: '42130', 244: '42130',
        245: '42130', 246: '42130', 247: '42130', 248: '42130',
        249: '42130', 250: '42130', 251: '42130', 252: '42130',
        253: '42130', 254: '42130', 255: '42130', 256: '42130',
        257: '42130', 258: '42130', 259: '42130',
        260: '42130', 261: '42130', 262: '42130', 263: '42130',
        264: '42130', 265: '42130', 266: '42130', 267: '42130',
        268: '42130', 269: '42130', 270: '42130', 271: '42130',
        272: '42133', 273: '42133', 274: '42133', 275: '42133',
        276: '42133', 277: '42133', 278: '42133', 279: '42133',
        280: '42133', 281: '42133', 282: '42133', 283: '42133',
        284: '42130', 285: '42130', 286: '42130', 287: '42130',
        288: '42130', 289: '42130', 290: '42130', 291: '42130',
        292: '42130', 293: '42130', 294: '42130', 295: '42130',
        300: '42130', 301: '42130', 302: '42130', 303: '42130',
        304: '42130', 305: '42130', 306: '42130', 307: '42130',
        308: '42130', 309: '42130', 310: '42130', 311: '42130',
        312: '42130', 313: '42130', 314: '42130', 315: '42130',
        316: '42130', 317: '42130', 318: '42130', 319: '42130',
        320: '42130', 321: '42130', 322: '42130', 323: '42130',
        324: '42130', 325: '42130', 326: '42130', 327: '42130',
        328: '42130', 329: '42130', 330: '42130', 331: '42130',
        332: '42130', 333: '42130',
        334: '42133', 335: '42133', 336: '42133',
        337: '42130', 338: '42133', 339: '42133',
        340: '42132', 341: '42132', 342: '49999', 343: '42132',
        344: '42132', 345: '49999', 346: '42132', 347: '42132',
        348: '49999', 349: '42132', 350: '42132', 351: '42132',
        352: '42132', 353: '42132', 354: '42132', 355: '42132',
        356: '42132', 357: '42132', 358: '42132', 359: '42132',
        360: '42130', 361: '42130', 362: '42130', 363: '42130',
        364: '42130', 365: '42130', 366: '42130',
        368: '42130', 369: '42130', 370: '42130', 371: '42130',
        372: '42130', 373: '42130', 374: '42130', 375: '42130',
        376: '42130', 377: '42130', 378: '42130',
        379: '42133', 380: '42133', 381: '42133', 382: '42133',
        383: '42130', 384: '42130', 385: '42130',
        386: '42133', 387: '42133', 388: '42133', 389: '42133',
        390: '42133', 391: '42133', 392: '42133', 393: '42133',
        394: '42133',
        395: '42130', 396: '42130', 397: '42130', 398: '42130',
        399: '42130',
        400: '42130', 401: '42130', 402: '42130', 403: '42130',
        404: '42130', 405: '42130', 406: '42130', 407: '42130',
        408: '42130', 409: '42130', 410: '42130', 411: '42130',
        412: '42130', 413: '42130', 414: '42130', 415: '42130',
        416: '42130', 417: '42130', 418: '42130', 419: '42130',
        420: '42130', 421: '42630', 422: '42133', 423: '42630',
        424: '42133', 425: '42630', 426: '42133', 427: '42630',
        428: '42133', 429: '42630', 430: '42630', 431: '42630',
        432: '42630', 433: '42630', 434: '42630', 435: '42630',
        436: '42630', 437: '42630', 438: '42130', 439: '42630',
        440: '42630', 441: '42630', 442: '42630', 443: '42630',
        444: '42630', 445: '42130', 446: '42630', 447: '42130',
        448: '42130', 449: '42130', 450: '42130', 451: '42130',
        452: '42130',
        453: '42132', 454: '42132', 455: '42132', 456: '42132',
        457: '42132', 458: '42132', 459: '42132',
        460: '42130',
        461: '42132', 462: '42132', 463: '42132', 464: '42132',
        465: '42132', 466: '42132', 467: '42132', 468: '42132',
        469: '42132',
        470: '42630', 471: '42630', 472: '42630', 473: '42630',
        474: '42630', 475: '42133', 476: '42630', 477: '42630',
        478: '42630', 479: '42630', 480: '42630', 481: '42133',
        482: '42630', 483: '42630', 484: '42630', 485: '42630',
        486: '42630', 487: '42133', 488: '42630', 489: '42133',
        490: '42630', 491: '42133', 492: '42630', 493: '42133',
        494: '42630', 495: '42133', 496: '42630', 497: '42133',
        498: '42630', 499: '42133',
        500: '42130', 501: '42130', 502: '42130', 503: '42130',
        504: '42130', 505: '42130', 506: '42130', 507: '42130',
        508: '42130', 509: '42130', 510: '42130', 511: '42130',
        512: '42130', 513: '42130', 514: '42130', 515: '42130',
        516: '42130', 517: '42130', 518: '42130', 519: '42130',
        520: '42130', 521: '42130', 522: '42130', 523: '42130',
        524: '42130', 525: '42130', 526: '42130', 527: '42130',
        528: '42130', 529: '42130', 530: '42130', 531: '42130',
        532: '42130', 533: '42130', 534: '42130', 535: '42130',
        536: '42130', 537: '42130', 538: '42130', 539: '42130',
        540: '42130', 541: '42130',
        542: '42133', 543: '42133', 544: '42133',
        545: '42130', 546: '42130', 547: '42130',
        548: '42630', 550: '42630', 551: '42130', 552: '42630',
        553: '42130', 554: '42630', 555: '42133', 556: '42630',
        557: '42133', 558: '42630', 559: '42130', 560: '42630',
        561: '42630', 562: '42630', 563: '42630', 564: '42630',
        565: '42630', 566: '42630', 567: '42630', 568: '42130',
        569: '42630', 570: '42130', 571: '42630', 572: '42130',
        573: '42630', 574: '42630', 575: '42133', 576: '42630',
        577: '42130', 578: '42630', 579: '42630',
        580: '42132', 581: '42132', 582: '42132', 583: '42132',
        584: '42132', 585: '42132', 586: '42132', 587: '42132',
        588: '42132', 589: '42132', 590: '42132', 591: '42132',
        592: '42132', 593: '42132',
        594: '42130', 595: '42132', 596: '42132', 597: '42133',
        598: '42133', 599: '42133',
        600: '42130', 601: '42130', 602: '42130',
        603: '42133', 604: '42133', 605: '42133', 606: '42133',
        607: '42133', 608: '42130', 609: '42133', 610: '42133',
        611: '42133',
        612: '42130', 613: '42130', 614: '42130', 615: '42130',
        616: '42130', 617: '42130', 618: '42130', 619: '42130',
        620: '42133', 621: '42133', 622: '42133', 623: '42133',
        624: '42133', 625: '42133', 626: '42133', 627: '42133',
        628: '42130', 629: '42130', 630: '42130', 631: '42130',
        632: '42130', 633: '42130', 634: '42130', 635: '42130',
        636: '42130', 637: '42130', 638: '42130', 639: '42130',
        640: '42133', 641: '42133', 642: '42133', 643: '42133',
        644: '42133', 645: '42133', 646: '42133', 647: '42133',
        648: '42133', 649: '42133', 650: '42133', 651: '42133',
        652: '42133', 653: '42133', 654: '42133', 655: '42133',
        656: '42133', 657: '42133', 658: '42133', 659: '42133',
        660: '42132', 661: '42132', 662: '42132', 663: '42132',
        664: '42132', 665: '42132', 666: '42132', 667: '42132',
        668: '42132', 669: '42132', 670: '42132', 671: '42132',
        672: '42132', 673: '42132', 674: '42132', 675: '42132',
        676: '42132', 677: '42132', 678: '42132', 679: '42132',
        680: '42132', 681: '42132', 682: '42132', 683: '42132',
        684: '42132', 685: '42132', 686: '42132', 687: '42132',
        688: '42132', 689: '42132', 690: '42132', 691: '42132',
        692: '42132', 693: '42132', 694: '42132', 695: '42132',
        696: '42132', 697: '42132', 698: '42132', 699: '42132',
        700: '42132', 701: '42132', 702: '42132', 703: '42132',
        704: '42132', 705: '42132', 706: '42132', 707: '42132',
        708: '42132', 709: '42132', 710: '42132', 711: '42132',
        712: '42132', 713: '42132', 714: '42132', 715: '42132',
        716: '42132', 717: '42132', 718: '42132', 719: '42132',
        720: '42130', 721: '42130', 722: '42130', 723: '42130',
        724: '42130', 725: '42130',
        726: '42133', 727: '42133', 728: '42133', 729: '42133',
        730: '42133', 731: '42133',
        732: '42130', 733: '42130', 734: '42130', 735: '42130',
        736: '42133', 737: '42133', 738: '42133', 739: '42133',
        740: '42133', 741: '42130', 742: '42130', 743: '42130',
        744: '42130', 745: '42130', 746: '42130', 747: '42130',
        748: '42130', 749: '42130', 750: '42130',
        751: '42630', 752: '42630', 753: '42630', 754: '42630',
        755: '42630', 756: '42630', 757: '42630', 758: '42630',
        759: '42630', 760: '42630', 761: '42630', 762: '42630',
        763: '42630', 764: '42630', 765: '42630', 766: '42630',
        767: '42630', 768: '42630', 769: '42630', 770: '42630',
        771: '42630', 772: '42630', 773: '42630', 774: '42630',
        775: '42130', 776: '42130', 777: '42133', 778: '42130',
        779: '42130', 780: '42133', 781: '42133', 782: '42133',
        783: '42133', 784: '42133', 785: '42133', 786: '42133',
        787: '42133', 788: '42133', 789: '42133', 790: '42133',
        791: '42133', 792: '42133', 793: '42133', 794: '42133',
        795: '42133', 796: '42133', 797: '42133', 798: '42133',
        799: '42133', 800: '42133', 801: '42133', 802: '42133',
        803: '42133', 804: '42133', 805: '42133', 806: '42133',
        807: '42133', 808: '42133', 809: '42133', 810: '42133',
        811: '42133', 812: '42133', 813: '42133', 814: '42133',
        815: '42133', 816: '42133', 817: '42133', 818: '42133',
        819: '42133', 820: '42133', 821: '42133', 822: '42133',
        823: '42133', 824: '42133', 825: '42133', 826: '42133',
        827: '42133', 828: '42133', 829: '42133', 830: '42133',
        831: '42133', 832: '42133', 833: '42133', 834: '42133',
        835: '42133', 836: '42133', 837: '42133', 838: '42133',
        839: '42133',
        850: '42130', 851: '49999', 852: '49999', 853: '49999',
        854: '42130', 855: '42130', 856: '42133', 857: '42133',
        858: '42133', 859: '42133', 860: '42133', 861: '42133',
        862: '42133', 863: '42133',
        864: '42130', 865: '42130', 866: '42130', 867: '42130',
        868: '42130', 869: '42130', 870: '42130', 871: '42130',
        872: '42130', 873: '42130', 874: '42130', 875: '42130',
        876: '42130', 877: '42130', 878: '42130', 879: '42130',
        880: '42130', 881: '42130', 882: '42130', 883: '42130',
        884: '42130', 885: '42130', 886: '42130', 887: '42130',
        888: '42130', 889: '42130', 890: '42130',
        891: '42130', 892: '42130', 893: '42133', 894: '42133',
        895: '42130', 896: '42133', 897: '42133', 898: '42130',
        899: '42130', 900: '42130', 901: '42130', 902: '42133',
        903: '42133', 904: '42130', 905: '42130',
        914: '42133', 915: '42133', 916: '42133', 917: '42133',
        918: '42133', 919: '42133', 920: '42133', 921: '42133',
        922: '42133', 923: '42133', 924: '42133', 925: '42133',
        926: '42133', 927: '42133', 928: '42133', 929: '42133',
        930: '42133', 931: '42133', 932: '42133', 933: '42133',
        934: '42133', 935: '42133', 936: '42133', 937: '42133',
        938: '42133', 939: '42133', 940: '42133',
        941: '42133', 942: '42133', 943: '42133', 944: '42133',
        945: '42133', 946: '42133', 947: '42133', 948: '42133',
        949: '42133', 950: '42133', 951: '42133', 952: '42133',
        953: '42133', 954: '42133', 955: '42133', 956: '42133',
        957: '42133', 958: '42133', 959: '42133', 960: '42133',
        961: '42133', 962: '42133', 963: '42133', 964: '42133',
        965: '42133', 966: '42133', 967: '42133',
        968: '42130', 969: '42130', 970: '42130', 971: '42130',
        972: '42130', 973: '42130', 974: '42130', 975: '42130',
        976: '42130', 977: '42130', 978: '42130', 979: '42130',
        980: '42130', 981: '42130', 982: '42130', 983: '42130',
        984: '42130', 985: '42130', 986: '42130', 987: '42133',
        988: '42133', 989: '42130', 990: '42130', 991: '42133',
        992: '42133', 993: '42133', 994: '42130', 995: '42130',
        996: '42130', 997: '42130',
    }

    @staticmethod
    def format(product_code: Optional[int]) -> str:
        """
        Apply FDPROD format to product code.

        Args:
            product_code: Product code to format

        Returns:
            BNM account code or default '42130' for FDs
        """
        if product_code is None:
            return '42130'

        return FDProductFormat.MAPPINGS.get(product_code, '42130')


# ============================================================================
# FORMAT: CADENOM - Current Account Denomination (Islamic or Domestic)
# ============================================================================

class CADenomFormat:
    """Current Account Denomination Format.
    Maps current account product codes to Islamic (I) or Domestic (D) classification.
    """

    ISLAMIC_PRODUCTS: Set[int] = {
        7, 8, 13, 14, 15, 16, 17, 18, 19, 20, 21, 23, 24, 25, 32, 33,
        45, 46, 47, 48, 49, 60, 61, 62, 63, 64, 66, 67, 70, 71, 73, 74,
        75, 76, 80, 81, 92, 93, 96, 97, 160, 161, 162, 163, 164, 165, 166,
        167, 168, 169, 182, 183, 184, 185, 186, 187, 188, 321
    }

    @staticmethod
    def format(product_code: Optional[int]) -> str:
        """
        Apply CADENOM format to product code.

        Args:
            product_code: Product code to format

        Returns:
            'I' for Islamic products, 'D' for Domestic, empty string if None
        """
        if product_code is None:
            return ''

        return 'I' if product_code in CADenomFormat.ISLAMIC_PRODUCTS else 'D'


# ============================================================================
# FORMAT: CAPROD - Current Account Product Code
# ============================================================================

class CAProductFormat:
    """Current Account Product Format.
    Maps current account product codes to BNM account codes.
    This is a simplified mapping; see full SAS code for complete list.
    """

    MAPPINGS: Dict[int, str] = {
        3: '42110', 4: '42110', 5: '42110', 6: '42110',
        7: '42110', 8: '42110', 9: '42110', 10: '42110',
        11: '42110', 12: '42110', 13: '42110', 14: '42110',
        15: '42110', 16: '42110', 17: '42110', 18: '42110',
        19: '42110', 20: '42110', 21: '42110', 23: '42110',
        24: '42110', 25: '42110', 26: '42110', 27: '42110',
        32: '42110', 33: '42110', 35: '42110', 36: '42110',
        37: '42110', 38: '42110', 39: '42110', 40: '42110',
        41: '42110', 42: '42110', 43: '42110', 45: '42110',
        46: '42110', 47: '42110', 48: '42110', 49: '42110',
        50: '42110', 51: '42110', 55: '42110', 56: '42110',
        57: '42110', 58: '42110', 60: '42110', 61: '42110',
        62: '42110', 63: '42110', 64: '42110', 65: '42110',
        66: '42110', 67: '42110', 68: '42110', 69: '42110',
        70: '42110', 71: '42110', 73: '42110', 74: '42110',
        75: '42110', 76: '42110', 77: '42110', 78: '42110',
        81: '42110', 82: '42110', 83: '42110', 84: '42110',
        85: '42110', 86: '42110', 87: '42110', 88: '42110',
        89: '42110', 90: '42110', 91: '42110', 92: '42110',
        93: '42110', 94: '42110', 95: '42110', 96: '42110',
        97: '42110', 100: '42110', 101: '42110', 102: '42110',
        104: '42110', 105: '42110', 106: '42110', 108: '42110',
        109: '42110', 110: '42110', 111: '42110', 112: '42110',
        113: '42110', 114: '42110', 115: '42110', 116: '42110',
        117: '42110', 118: '42110', 119: '42110', 120: '42110',
        121: '42110', 122: '42110', 123: '42110', 124: '42110',
        125: '42110', 131: '42110', 132: '42110', 133: '42110',
        134: '42110', 135: '42110', 137: '42110', 138: '42110',
        150: '42110', 151: '42110', 152: '42110', 153: '42110',
        154: '42110', 155: '42110', 156: '42110', 157: '42110',
        158: '42110', 159: '42110', 160: '42110', 161: '42110',
        162: '42110', 163: '42110', 164: '42110', 165: '42110',
        166: '42310', 167: '42110', 168: '42110', 169: '42110',
        170: '42110', 174: '42110', 175: '42110', 176: '42110',
        177: '42110', 178: '42110', 179: '42110', 180: '42110',
        181: '42110', 182: '42110', 183: '42110', 184: '42110',
        185: '42110', 186: '42110', 187: '42110', 188: '42110',
        189: '42110', 190: '42110', 191: '42110', 192: '42110',
        193: '42110', 194: '42110', 195: '42110', 196: '42110',
        197: '42110', 198: '42110',
    }

    @staticmethod
    def format(product_code: Optional[int]) -> str:
        """
        Apply CAPROD format to product code.

        Args:
            product_code: Product code to format

        Returns:
            BNM account code or default '42110' for current accounts
        """
        if product_code is None:
            return '42110'

        return CAProductFormat.MAPPINGS.get(product_code, '42110')


# ============================================================================
# FORMAT: FCYTERM - Foreign Currency Term (INVALUE format)
# ============================================================================

class FCYTermFormat:
    """Foreign Currency Term Mapping based on Interest Plan.
    Maps interest plan codes to FCY term lengths in months.
    """

    # Term in months: 1
    TERM_1_MONTH: Set[int] = {
        470, 471, 476, 477, 482, 483, 488, 494, 548, 554,
        429, 433, 437, 421, 567, 574, 439, 751, 755, 756, 759, 762, 767, 771
    }

    # Term in months: 3
    TERM_3_MONTHS: Set[int] = {
        472, 473, 478, 479, 484, 485, 490, 496, 550, 551, 556,
        569, 576, 440, 441, 423, 752, 757, 760, 763, 768, 772, 430, 434
    }

    # Term in months: 6
    TERM_6_MONTHS: Set[int] = {
        474, 480, 486, 492, 498, 552, 553, 558,
        571, 578, 579, 442, 443, 425, 753, 761, 764, 765, 769, 773, 431, 435, 758
    }

    # Term in months: 12
    TERM_12_MONTHS: Set[int] = {
        444, 446, 545, 546, 547, 560, 561, 562, 563, 564, 565, 566,
        573, 427, 754, 766, 770, 774, 432, 436
    }

    @staticmethod
    def format(intplan_code: Optional[int]) -> Optional[int]:
        """
        Apply FCYTERM format to interest plan code.

        Args:
            intplan_code: Interest plan code

        Returns:
            Term length in months (1, 3, 6, 12) or None if not found
        """
        if intplan_code is None:
            return None

        if intplan_code in FCYTermFormat.TERM_1_MONTH:
            return 1
        elif intplan_code in FCYTermFormat.TERM_3_MONTHS:
            return 3
        elif intplan_code in FCYTermFormat.TERM_6_MONTHS:
            return 6
        elif intplan_code in FCYTermFormat.TERM_12_MONTHS:
            return 12
        else:
            return None


# ============================================================================
# UTILITY FUNCTIONS
# ============================================================================

def get_format(format_name: str) -> Optional[object]:
    """
    Get format class by name.

    Args:
        format_name: Name of format (e.g., 'SADENOM', 'SAPROD', 'FDDENOM', etc.)

    Returns:
        Format class or None if not found
    """
    formats = {
        'SADENOM': SADenomFormat,
        'SAPROD': SAProductFormat,
        'FDDENOM': FDDenomFormat,
        'FDPROD': FDProductFormat,
        'CADENOM': CADenomFormat,
        'CAPROD': CAProductFormat,
        'FCYTERM': FCYTermFormat,
        'PRODUCTS': ProductLists,
    }

    return formats.get(format_name.upper())


def apply_format(format_name: str, value: Optional[int]) -> str:
    """
    Apply a named format to a value.

    Args:
        format_name: Name of format to apply
        value: Value to format

    Returns:
        Formatted value or empty string if value is None
    """
    format_class = get_format(format_name)

    if format_class is None:
        return ''

    if hasattr(format_class, 'format'):
        return format_class.format(value)

    return ''


# ============================================================================
# EXAMPLE USAGE
# ============================================================================

if __name__ == '__main__':
    # Example format applications
    print("Format Examples:")
    print(f"SADENOM(200) = {SADenomFormat.format(200)}")  # D
    print(f"SADENOM(204) = {SADenomFormat.format(204)}")  # I
    print(f"SAPROD(200) = {SAProductFormat.format(200)}")  # 42120
    print(f"CAPROD(104) = {CAProductFormat.format(104)}")  # 42110
    print(f"ACE Products: {ProductLists.ACE_PRODUCTS}")
    print(f"FCY Products: {ProductLists.FCY_PRODUCTS}")
