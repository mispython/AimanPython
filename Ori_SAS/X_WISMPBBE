/** PROGRAM : WISMPBBE                                      **/
/** DATE    : 14/05/97                                      **/
/** PURPOSE : TO EXTRACT THE INFORMATION FROM               **/
/**           RDAL1 AND RDAL2 EXTRACTION TO BE USED FOR     **/
/**           MIS REPORTING                                 **/

%INC PGM(WISMPBBF);

PROC SORT DATA=SETITEMS OUT=ITEMS(KEEP=SET_ID) NODUPKEYS;
BY SET_ID;
RUN;

PROC SQL;
  CREATE TABLE GLW AS
  SELECT T1.BRNO,
         T1.SET_ID, T1.GLAMT,
         SUBSTR(T1.ACCT_NO, 8, 5) AS ACK_NO FROM
  BNM.ALWGL&REPTMON&NOWK T1, ITEMS T2
  WHERE T1.SET_ID = T2.SET_ID;
QUIT;

PROC SUMMARY DATA=GLW NWAY;
CLASS BRNO SET_ID ACK_NO;
VAR GLAMT;
OUTPUT OUT=GLW (DROP=_TYPE_ _FREQ_)
       SUM=GLAMT;
RUN;

PROC SQL;
  CREATE TABLE JEW AS
  SELECT T1.BRNO,
         T1.SET_ID, T1.JEAMT,
         SUBSTR(T1.ACCT_NO, 8, 5) AS ACK_NO,
         T1.EFFDATE FROM
  BNM.ALWJE&REPTMON&NOWK T1, ITEMS T2
  WHERE T1.SET_ID = T2.SET_ID;
QUIT;

PROC SUMMARY DATA=JEW NWAY;
CLASS BRNO SET_ID ACK_NO;
VAR JEAMT;
OUTPUT OUT=JEW (DROP=_TYPE_ _FREQ_)
       SUM=JEAMT;
RUN;

PROC SORT DATA=GLW OUT=GLW;
BY BRNO SET_ID ACK_NO;
RUN;

DATA MIS.WISMON&REPTMON;
  MERGE GLW
        JEW;
  BY BRNO SET_ID ACK_NO;
  AMOUNT=SUM(GLAMT, JEAMT);
  DROP GLAMT JEAMT;
RUN;

PROC SQL;
  CREATE TABLE GLM AS
  SELECT T1.BRNO,
         T1.SET_ID, T1.GLAMT AS AMOUNT,
         SUBSTR(T1.ACCT_NO, 8, 5) AS ACK_NO FROM
  BNM.ALMGL&REPTMON&NOWK T1, ITEMS T2
  WHERE T1.SET_ID = T2.SET_ID;
QUIT;

PROC SUMMARY DATA=GLM NWAY;
CLASS BRNO SET_ID ACK_NO;
VAR AMOUNT;
OUTPUT OUT=GLM (DROP=_TYPE_ _FREQ_)
       SUM=AMOUNT;
RUN;

PROC APPEND DATA=GLM BASE=MIS.WISMON&REPTMON; RUN;
