OPTIONS YEARCUTOFF=1950 SORTDEV=3390 NONUMBER NODATE NOCENTER;
*;
DATA REPTDATE;
   SET DEPOSIT.REPTDATE;
   MM=MONTH(REPTDATE);
   MM1=MM-1;
   IF MM1=0 THEN MM1=12;
   CALL SYMPUT('RDATE',PUT(REPTDATE,DDMMYY8.));
   CALL SYMPUT('RYEAR',PUT(REPTDATE,YEAR4.));
   CALL SYMPUT('RMONTH',PUT(REPTDATE,MONTH2.));
   CALL SYMPUT('REPTMON',PUT(MM,Z2.));
   CALL SYMPUT('REPTMON1',PUT(MM1,Z2.));
   CALL SYMPUT('RDAY',PUT(REPTDATE,DAY2.));
RUN;
DATA SAVG;
  SET DEPOSIT.SAVING;
  IF  (200<=PRODUCT<=207) OR
      (212<=PRODUCT<=216) OR
      (220<=PRODUCT<=223) OR
       PRODUCT=218;
  IF BRANCH=227 THEN DELETE;
  IF BRANCH=250 THEN BRANCH=092;

  IF  OPENIND='Z'  THEN DO;
      OPENIND='O'; CLOSEMH=0;
  END;
  IF  OPENIND='O'  OR
      OPENIND IN ('B','C','P') AND CLOSEMH=1;

  NOACCT=0; BCLOSE=0; CCLOSE=0;
  IF  OPENIND IN ('B','C','P') THEN DO;
      IF OPENIND='C'  THEN CCLOSE=CLOSEMH;
                      ELSE BCLOSE=CLOSEMH;
  END;
  ELSE DO;
      NOACCT=1;
  END;
*;
DATA MIS.SAVGC&REPTMON;
  KEEP BRANCH ACCTNO OPENDT CLOSEDT OPENIND CURBAL CUSTCODE
       MTDAVBAL YTDAVBAL CUSTFISS DOBMNI PRODUCT CHGIND COSTCTR DEPTYPE
       DNBFISME INTPD INTPLAN INTRSTPD INTYTD LASTTRAN ORGCODE ORGTYPE
       PURPOSE RISKCODE SECOND SECTOR SERVICE STATE USER2 USER3 USER5
       STMT_CYCLE NXT_STMT_CYCLE_DT;
  SET SAVG;
  IF  OPENIND IN ('B','C','P');
  IF  CLOSEMH=1;
  YTDAVBAL=YTDAVAMT;
  CUSTFISS=0;
  IF LASTTRAN NOT IN (0,.) THEN
     LASTTRAN = INPUT(SUBSTR(PUT(LASTTRAN,Z9.),1,6),MMDDYY6.);
      IF BDATE NOT IN (0,.) THEN
         BIRTHS = INPUT(SUBSTR(PUT(BDATE,Z11.),1,8),MMDDYY8.);
      ELSE BIRTHS = 0;
      DOBMNI= BIRTHS;
*;
PROC   SUMMARY DATA=SAVG NWAY;
CLASS  BRANCH PRODUCT;
VAR    OPENMH CURBAL NOACCT CLOSEMH BCLOSE CCLOSE;
OUTPUT OUT=SAVG (DROP=_FREQ_ _TYPE_) SUM=;
*;
%MACRO PROCESS;
   %IF &REPTMON > 01  %THEN %DO;

      DATA SAVP;
        SET MIS.SAVGF&REPTMON1;
        OPENCUX =OPENCUM;
        CLOSECUX=CLOSECUM;
        IF BRANCH=227 THEN BRANCH=81;
        IF BRANCH=250 THEN BRANCH=092;

        PROC  SUMMARY DATA=SAVP NWAY;
        CLASS  BRANCH PRODUCT;
        VAR    OPENCUX CLOSECUX;
        OUTPUT OUT=SAVP (DROP=_FREQ_ _TYPE_) SUM=;

      DATA SAVG;
        MERGE SAVP SAVG; BY BRANCH PRODUCT;
        IF CLOSECUX=.   THEN CLOSECUX=0;
        IF OPENCUX =.   THEN  OPENCUX=0;
        IF OPENMH  =.   THEN  OPENMH =0;
        IF CLOSEMH =.   THEN CLOSEMH =0;
        IF BCLOSE  =.   THEN BCLOSE  =0;
        IF CCLOSE  =.   THEN CCLOSE  =0;
        IF NOACCT  =.   THEN  NOACCT =0;
        IF CURBAL  =.   THEN  CURBAL =0;
        IF BCLOSE  =.   THEN  BCLOSE =0;
        IF CCLOSE  =.   THEN  CCLOSE =0;

        OPENCUM =OPENMH  +OPENCUX;
        CLOSECUM=CLOSEMH +CLOSECUX;
        NETCHGMH=OPENMH  -CLOSEMH;
        NETCHGYR=OPENCUM -CLOSECUM;

   %END;
   %ELSE %DO;
      DATA SAVG;
        SET SAVG;
        OPENCUM =OPENMH;
        CLOSECUM=CLOSEMH;
        NETCHGMH=OPENMH  -CLOSEMH;
        NETCHGYR=OPENCUM -CLOSECUM;
   %END;

%MEND PROCESS;

%PROCESS;

DATA MIS.SAVGF&REPTMON;
  SET SAVG;
*;
*------------------------------------------------*
*  PRINT REPORT TO TEXT FILE                     *
*------------------------------------------------*;
TITLE1 'PUBLIC ISLAMIC BANK BERHAD';
TITLE2 'SAVINGS ACCOUNT OPENED/CLOSED FOR THE MONTH AS AT' &RDATE;
PROC TABULATE DATA=SAVG FORMAT=COMMA10. MISSING NOSEPS
   FORMCHAR='           ';
   CLASS BRANCH;
   VAR   OPENMH CLOSEMH NOACCT CURBAL CLOSECUM OPENCUM
         NETCHGMH NETCHGYR BCLOSE CCLOSE;
   TABLE BRANCH  =' ' ALL='TOTAL',SUM='  '*
        (OPENMH  ='CURRENT MONTH OPENED'
         OPENCUM ='CUMULATIVE OPENED'
         CLOSEMH ='CURRENT MONTH CLOSED'
         BCLOSE  ='CLOSED BY BANK'
         CCLOSE  ='CLOSED BY CUSTOMER'
         CLOSECUM='CUMULATIVE CLOSED'
         NOACCT  ='NO.OF ACCTS'
         CURBAL  ='TOTAL (RM) O/S'*F=COMMA17.2
         NETCHGMH='NET CHANGE FOR THE MONTH'
         NETCHGYR='NET CHANGE YEAR TO DATE')
       / BOX='BRANCH' RTS=8;
