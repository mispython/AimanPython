/** PROGRAM : EIBRDL2B                             **/
/** DATE    : 30/9/01                              **/
/** REPORT  : RDAL PART II (OUTPUT TO WALKER ONLY) **/

DATA OTHER;
  SET BNM.DALM&REPTMON&NOWK
      BNM.FALM&REPTMON&NOWK
      BNM.KALM&REPTMON&NOWK
      BNM.NALM&REPTMON&NOWK
      BNM.LALM&REPTMON&NOWK;
     AMOUNT = 0;
RUN;

PROC SUMMARY DATA=OTHER NWAY;
CLASS BNMCODE AMTIND;
VAR AMOUNT;
OUTPUT OUT=OTHER (DROP=_TYPE_ _FREQ_)
       SUM=AMOUNT;
RUN;

PROC SORT DATA=BNM.WALW&REPTMON&NOWK OUT=WALW;
BY BNMCODE AMTIND;
RUN;

PROC SORT DATA=OTHER OUT=OTHER;
BY BNMCODE AMTIND;
RUN;

DATA BNM.ALMWK&REPTMON (KEEP=ITCODE AMOUNT AMTIND);
  LENGTH BNMCODE $14.;
  MERGE WALW (RENAME=(AMOUNT=WISAMT) IN=A)
        OTHER (RENAME=(AMOUNT=OTHAMT) IN=B);
  BY BNMCODE AMTIND;
  RENAME BNMCODE=ITCODE;
  IF A AND B THEN DO;
     AMOUNT=OTHAMT;
     OUTPUT BNM.ALMWK&REPTMON;
  END;
  IF A AND NOT B THEN DO;
     AMOUNT=WISAMT;
     OUTPUT BNM.ALMWK&REPTMON;
  END;
  IF B AND NOT A THEN DO;
     AMOUNT=OTHAMT;
     OUTPUT BNM.ALMWK&REPTMON;
  END;
RUN;

PROC SORT DATA=BNM.ALWWK&REPTMON&NOWK;
BY ITCODE AMTIND;

DATA BNM.ALMWK&REPTMON;
   MERGE BNM.ALWWK&REPTMON&NOWK (IN=A)
         BNM.ALMWK&REPTMON      (IN=B);
   BY ITCODE AMTIND;
   IF B AND NOT A;
      IF SUBSTR(ITCODE,1,2) ^ IN ('37') THEN OUTPUT;
RUN;

/* MERGE MONTHLY ITEMS INTO WEEKLY (19/11) */
/* AS EL REPORTING REQUIRE MONTHLY ITEMS   */
PROC APPEND DATA=BNM.ALMWK&REPTMON BASE=BNM.ALWWK&REPTMON&NOWK;
RUN;

PROC DATASETS LIB=BNM NOLIST; DELETE ALMWK&REPTMON; RUN;
