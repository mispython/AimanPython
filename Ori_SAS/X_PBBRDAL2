/** PROGRAM : PBBRDAL2                       **/
/** DATE    : 22/1/97                        **/
/** REPORT  : RDAL PART II                   **/

DATA OTHER;
  SET BNM.DALM&REPTMON&NOWK
      BNM.FALM&REPTMON&NOWK
      BNM.KALM&REPTMON&NOWK
      BNM.NALM&REPTMON&NOWK
      BNM.LALM&REPTMON&NOWK;
RUN;

PROC SUMMARY DATA=OTHER NWAY;
CLASS BNMCODE AMTIND;
VAR AMOUNT;
OUTPUT OUT=OTHER (DROP=_TYPE_ _FREQ_)
       SUM=AMOUNT;
RUN;

PROC SORT DATA=BNM.WALW&REPTMON&NOWK OUT=WALW;
BY BNMCODE AMTIND;
RUN;

PROC SORT DATA=OTHER OUT=OTHER;
BY BNMCODE AMTIND;
RUN;

DATA BNM.ALM&REPTMON (KEEP=ITCODE AMOUNT AMTIND)
     BNM.ALMLG&REPTMON (KEEP=ITCODE WISAMT OTHAMT AMTIND);
  LENGTH BNMCODE $14.;
  MERGE WALW (RENAME=(AMOUNT=WISAMT) IN=A)
        OTHER (RENAME=(AMOUNT=OTHAMT) IN=B);
  BY BNMCODE AMTIND;
  RENAME BNMCODE=ITCODE;
  IF A AND B THEN DO;
     AMOUNT=OTHAMT;
     OUTPUT BNM.ALM&REPTMON
            BNM.ALMLG&REPTMON;
  END;
  IF A AND NOT B THEN DO;
     AMOUNT=WISAMT;
     OUTPUT BNM.ALM&REPTMON;
  END;
  IF B AND NOT A THEN DO;
     AMOUNT=OTHAMT;
     OUTPUT BNM.ALM&REPTMON;
  END;
RUN;

PROC SORT DATA=BNM.ALW&REPTMON&NOWK;
BY ITCODE AMTIND;

DATA BNM.ALM&REPTMON;
   MERGE BNM.ALW&REPTMON&NOWK (IN=A)
         BNM.ALM&REPTMON      (IN=B);
   BY ITCODE AMTIND;
   IF B AND NOT A;
      IF SUBSTR(ITCODE,1,2) ^ IN ('37') THEN OUTPUT;
RUN;

/* MERGE MONTHLY ITEMS INTO WEEKLY (19/11) */
/* AS EL REPORTING REQUIRE MONTHLY ITEMS   */
PROC APPEND DATA=BNM.ALM&REPTMON BASE=BNM.ALW&REPTMON&NOWK;
RUN;

PROC DATASETS LIB=BNM NOLIST; DELETE ALM&REPTMON; RUN;
