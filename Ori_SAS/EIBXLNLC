//EIBXLNLC JOB MSGCLASS=X,MSGLEVEL=(1,1),REGION=64M
//EIBMLNLC  EXEC SAS609
//LNNOTE   DD DSN=SAP.PBB.MNILN(0),DISP=SHR
//LOAN     DD DSN=SAP.PBB.SASDATA,DISP=SHR
//LNLC     DD DSN=SAP.PBB.LOANLIST.SASDATA,DISP=OLD
//SASLIST  DD SYSOUT=X
//SORTWK01 DD UNIT=SYSDA,SPACE=(CYL,(500))
//SORTWK02 DD UNIT=SYSDA,SPACE=(CYL,(500))
//SORTWK03 DD UNIT=SYSDA,SPACE=(CYL,(500))
//SORTWK04 DD UNIT=SYSDA,SPACE=(CYL,(500))
//SYSIN    DD *

OPTIONS YEARCUTOFF=1950 SORTDEV=3390;
OPTIONS NODATE NONUMBER NOCENTER;
TITLE;

PROC FORMAT;
   VALUE BANKFMT 33='PBB'
                 134='PFB';
RUN;

DATA _NULL_;
   SET LOAN.REPTDATE;
   SELECT(DAY(REPTDATE));
     WHEN (8)  DO; SDD = 1;  WK = '1'; WK1 = '4'; END;
     WHEN(15)  DO; SDD = 9;  WK = '2'; WK1 = '1'; END;
     WHEN(22)  DO; SDD = 16; WK = '3'; WK1 = '2'; END;
     OTHERWISE DO; SDD = 23; WK = '4'; WK1 = '3'; END;
   END;
   CALL SYMPUT('NOWK',PUT(WK,$1.));
   CALL SYMPUT('RDATE', PUT(REPTDATE, DDMMYY8.));
   CALL SYMPUT('REPTMON', PUT(MONTH(REPTDATE), Z2.));
   CALL SYMPUT('REPTYEAR', PUT(REPTDATE, YEAR4.));
RUN;
PROC SORT DATA=LNNOTE.LNNOTE (KEEP=ACCTNO NOTENO BANKNO STATE)
   OUT=LNNOTE;
   BY ACCTNO NOTENO;
*;
PROC SORT DATA=LOAN.LOAN&REPTMON&NOWK OUT=LOAN;
   BY ACCTNO NOTENO;

DATA LNOTE (KEEP=BANKNO BRANCH ACCTNO NOTENO NAME BALANCE
            SECTORCD CUSTCD INTRATE NTBRCH COMMNO LIABCODE
            APPRLIMT FISSPURP STATE);
  MERGE LOAN (IN=A) LNNOTE (IN=B);
  BY ACCTNO NOTENO;
  IF ACCTYPE = 'LN';

PROC SORT DATA=LNOTE;
BY ACCTNO COMMNO;
RUN;

PROC SORT DATA=LNNOTE.LNCOMM OUT=LNCOMM;
BY ACCTNO COMMNO;
RUN;

DATA NOTE1 (KEEP=BANKNO BRANCH ACCTNO NOTENO NAME APPRLIMT BALANCE
            SECTORCD CUSTCD STATE INTRATE NTBRCH COMMNO LIABCODE
            CCOLLTRL FISSPURP);
  MERGE LNOTE (IN=A)
        LNCOMM (IN=B);
  BY ACCTNO COMMNO;
  IF A;
*;
DATA NOTE2 (KEEP=BANKNO BRANCH ACCTNO NOTENO NAME APPRLIMT BALANCE
            SECTORCD CUSTCD STATE INTRATE NTBRCH COMMNO LIABCODE
            CCOLLTRL FISSPURP);
  SET NOTE1;
  IF CUSTCD NOT IN ('77','78','95','96') AND
    (SUBSTR(SECTORCD,1,1) = '5' OR SECTORCD = '8310') THEN OUTPUT;
RUN;

PROC DATASETS LIB=WORK NOLIST; DELETE LNOTE LNCOMM; RUN;

PROC SORT DATA=NOTE1 OUT=LNLC.NOTE1&REPTMON;
   BY BRANCH FISSPURP CUSTCD ACCTNO;
RUN;
PROC SORT DATA=NOTE2 OUT=LNLC.NOTE2&REPTMON;
   BY BRANCH SECTORCD CUSTCD ACCTNO;
RUN;
*;
//**************************************************************
//* FOR PIBB
//**************************************************************
//EIIXLNLC  EXEC SAS609,REGION=8M,WORK='12000,12000'
//LNNOTE   DD DSN=SAP.PIBB.MNILN(0),DISP=SHR
//LOAN     DD DSN=SAP.PIBB.SASDATA,DISP=SHR
//LNLCI    DD DSN=SAP.PIBB.LOANLIST.SASDATA,DISP=OLD
//SASLIST  DD SYSOUT=X
//SYSIN    DD *

OPTIONS YEARCUTOFF=1950 SORTDEV=3390;
OPTIONS NODATE NONUMBER NOCENTER;
TITLE;

PROC FORMAT;
   VALUE BANKFMT 33='PBB'
                 134='PFB';
RUN;

DATA _NULL_;
   SET LOAN.REPTDATE;
   SELECT(DAY(REPTDATE));
     WHEN (8)  DO; SDD = 1;  WK = '1'; WK1 = '4'; END;
     WHEN(15)  DO; SDD = 9;  WK = '2'; WK1 = '1'; END;
     WHEN(22)  DO; SDD = 16; WK = '3'; WK1 = '2'; END;
     OTHERWISE DO; SDD = 23; WK = '4'; WK1 = '3'; END;
   END;
   CALL SYMPUT('NOWK',PUT(WK,$1.));
   CALL SYMPUT('RDATE', PUT(REPTDATE, DDMMYY8.));
   CALL SYMPUT('REPTMON', PUT(MONTH(REPTDATE), Z2.));
   CALL SYMPUT('REPTYEAR', PUT(REPTDATE, YEAR4.));
RUN;
RUN;
PROC SORT DATA=LNNOTE.LNNOTE (KEEP=ACCTNO NOTENO BANKNO STATE)
   OUT=LNNOTE;
   BY ACCTNO NOTENO;
*;
PROC SORT DATA=LOAN.LOAN&REPTMON&NOWK OUT=LOAN;
   BY ACCTNO NOTENO;


DATA LNOTE (KEEP=BANKNO BRANCH ACCTNO NOTENO NAME BALANCE
            SECTORCD CUSTCD INTRATE NTBRCH COMMNO LIABCODE
            APPRLIMT FISSPURP STATE);
  MERGE LOAN (IN=A) LNNOTE (IN=B);
  BY ACCTNO NOTENO;
  IF ACCTYPE = 'LN';

PROC SORT DATA=LNOTE;
BY ACCTNO COMMNO;
RUN;

PROC SORT DATA=LNNOTE.LNCOMM OUT=LNCOMM;
BY ACCTNO COMMNO;
RUN;

DATA NOTE1 (KEEP=BANKNO BRANCH ACCTNO NOTENO NAME APPRLIMT BALANCE
            SECTORCD CUSTCD STATE INTRATE NTBRCH COMMNO LIABCODE
            CCOLLTRL FISSPURP);
  MERGE LNOTE (IN=A)
        LNCOMM (IN=B);
  BY ACCTNO COMMNO;
  IF A;
*;
DATA NOTE2 (KEEP=BANKNO BRANCH ACCTNO NOTENO NAME APPRLIMT BALANCE
            SECTORCD CUSTCD STATE INTRATE NTBRCH COMMNO LIABCODE
            CCOLLTRL FISSPURP);
  SET NOTE1;
  IF CUSTCD NOT IN ('77','78','95','96') AND
    (SUBSTR(SECTORCD,1,1) = '5' OR SECTORCD = '8310') THEN OUTPUT;
RUN;

PROC DATASETS LIB=WORK NOLIST; DELETE LNOTE LNCOMM; RUN;

PROC SORT DATA=NOTE1 OUT=LNLCI.NOTE1&REPTMON;
   BY BRANCH FISSPURP CUSTCD ACCTNO;
RUN;
PROC SORT DATA=NOTE2 OUT=LNLCI.NOTE2&REPTMON;
   BY BRANCH SECTORCD CUSTCD ACCTNO;
RUN;
